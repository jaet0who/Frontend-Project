<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Library</title>
  <link rel="stylesheet" href="Offer.css">
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="logo"><video src="books (1).mp4" width="50px" autoplay muted loop></video></div>
    <ul>
      <li id="home-link"> <img src="home.png" alt="" width="20px"><a href="index.html">Home</a></li>
      <li id="books-link"><img src="open-book.png" alt="" width="20px"><a onclick="goToBooks()">Books</a></li>
      <li id="cart-link"><img src="shopping-cart.png" alt="" width="20px"><a href="cart.html">Cart</a></li>
      <li id="feedback-link"><img src="feedback.png" alt="" width="20px"><a href="Feedback.html">Feedback</a></li>
    </ul>
    <a id="Login-btn">Login</a>
  </nav>

  <!-- SEARCH -->
  <div class="search-bar">
    <input list="Search" name="Search" placeholder="Search for books..." id="searchInput">
    <datalist id="Search">
      <option value="الدحيح"></option>
      <option value="Atomic Habits"></option>
      <option value="Surrounded by idiots"></option>
      <option value="Harry Potter"></option>
      <option value="Peter Pan & Wendy"></option>
      <option value="Who Moved My Cheese"></option>
      <option value="نظرية الفستق"></option>
      <option value="فن اللامبالاة"></option>
      <option value="Your Next Five Moves"></option>
      <option value="201 Great Ideas for your small business"></option>
      <option value="عزيزي المستبد"></option>
    </datalist>
    <button id="searchBtn">Search</button>
  </div>

  <!-- BOOKS -->
  <div class="books-section" id="booksContainer"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {

      let books = JSON.parse(localStorage.getItem("books")) || [];

      const container = document.getElementById("booksContainer");
      const input = document.getElementById("searchInput");
      const searchBtn = document.getElementById("searchBtn");

      container.innerHTML = "";

      // ===== Render Books =====
      books.forEach((book, index) => {

        const div = document.createElement("div");
        div.className = "book-item";

        div.innerHTML = `
          <div class="book-frame">
              <img src="${book.img}" alt="${book.name}">
          </div>

          <div class="book-buttons">
              <button class="buy-btn" ${book.hidden ? "disabled" : ""} 
                      data-price="${book.price}" 
                      data-index="${index}">
                ${book.hidden ? "Unavailable" : "Buy"}
              </button>

              <button class="borrow-btn" ${book.hidden ? "disabled" : ""} data-index="${index}">
                Borrow
              </button>
          </div>
        `;

        if (book.hidden) {
          div.style.opacity = "0.4";
          div.classList.add("unavailable");
        }

        container.appendChild(div);
      });

      const bookItems = document.querySelectorAll('.book-item');

      // ===== SEARCH =====
      searchBtn.addEventListener('click', () => {
        const val = input.value.trim().toLowerCase();

        if (searchBtn.innerText === "Back") {
          bookItems.forEach(b => b.style.display = "flex");
          searchBtn.innerText = "Search";
          input.value = "";
          return;
        }

        if (!val) return;

        let target = null;
        bookItems.forEach(book => {
          const img = book.querySelector("img");
          if (img.alt.toLowerCase() === val) {
            target = book;
          }
        });

        if (target) {
          bookItems.forEach(b => b.style.display = "none");
          target.style.display = "flex";
          target.scrollIntoView({ behavior: "smooth", block: "center" });
          searchBtn.innerText = "Back";
        }
      });

      // ===== BUY BUTTON =====
      document.querySelectorAll('.buy-btn').forEach(btn => {
        if (!btn.disabled) {

          // Hover show price
          btn.addEventListener('mouseenter', () => {
            btn.textContent = btn.dataset.price + " EGP";
          });

          btn.addEventListener('mouseleave', () => {
            btn.textContent = "Buy";
          });

          // CLICK add to cart
          btn.addEventListener("click", () => {
            const index = btn.dataset.index;
            addToCart(books[index], "buy");
          });
        }
      });

      // ===== BORROW BUTTON =====
      document.querySelectorAll('.borrow-btn').forEach(btn => {
        if (!btn.disabled) {
          btn.addEventListener("click", () => {
            const index = btn.dataset.index;
            addToCart(books[index], "borrow");
            btn.textContent = "Borrowed";
            btn.disabled = true;
          });
        }
      });

      // ===== OPEN BOOK DETAILS WHEN CLICK IMAGE =====
      document.querySelectorAll('.book-frame img').forEach((img, index) => {
        img.addEventListener("click", () => {
          window.location.href = `book${index + 1}.html`;
        });
      });

    });

    // ====== ADD TO CART FUNCTION ======
    function addToCart(book, type) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      cart.push({
        name: book.name,
        img: book.img,
        price: book.price,
        type: type
      });

      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${book.name} added to cart ✔`);
    }
  </script>

  <script src="auth.js"></script>

</body>

</html>